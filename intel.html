<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winter Study Room - Pomodoro Timer with Lofi Girl</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Comfortaa:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Comfortaa', sans-serif;
            background: linear-gradient(135deg, #F5E6D3 0%, #E8D5C4 50%, #F0E2D0 100%);
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
        }

        /* ã‚¯ãƒªã‚¹ãƒã‚¹ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
        :root {
            --christmas-red: #C41E3A;
            --christmas-green: #165B33;
            --christmas-gold: #D4AF37;
            --warm-white: #FFF8F0;
            --wood-brown: #8B6F47;
            --light-glow: #FFD700;
        }

        /* é›ªã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .snow {
            position: fixed;
            top: -10px;
            z-index: 9999;
            pointer-events: none;
        }

        @keyframes snowfall {
            0% {
                transform: translateY(-10px) translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) translateX(30px);
                opacity: 0.3;
            }
        }

        .snowflake {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            opacity: 0.6;
            animation: snowfall linear infinite;
        }

        /* ãƒ©ã‚¤ãƒˆã®ã‚°ãƒ­ãƒ¼åŠ¹æœ */
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5), 0 0 20px rgba(255, 215, 0, 0.3);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.5);
            }
        }

        .light-bulb {
            animation: glow 2s ease-in-out infinite;
        }

        /* æœ¨è£½ãƒ‘ãƒãƒ« */
        .wood-panel {
            background: linear-gradient(135deg, #A0826D 0%, #8B6F47 50%, #9A7B5C 100%);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            padding: 2rem;
        }

        .wood-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 10px,
                rgba(0, 0, 0, 0.03) 10px,
                rgba(0, 0, 0, 0.03) 11px
            );
            border-radius: 20px;
            pointer-events: none;
        }

        /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .btn-warm {
            background: linear-gradient(135deg, var(--christmas-red), #E63946);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
        }

        .btn-warm:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 30, 58, 0.5);
        }

        .btn-green {
            background: linear-gradient(135deg, var(--christmas-green), #2D8659);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(22, 91, 51, 0.3);
        }

        .btn-green:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(22, 91, 51, 0.5);
        }

        /* YouTubeé¸æŠã‚«ãƒ¼ãƒ‰ */
        .stream-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
        }

        .stream-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(196, 30, 58, 0.3);
            border-color: var(--christmas-red);
        }

        /* ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º */
        .timer-display {
            font-size: 5rem;
            font-weight: 700;
            color: var(--warm-white);
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            font-family: 'Comfortaa', sans-serif;
            letter-spacing: 0.1em;
        }

        /* ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
        .preset-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .preset-btn:hover, .preset-btn.active {
            background: rgba(255, 255, 255, 0.4);
            border-color: var(--light-glow);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        /* ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒˆ */
        .decoration-lights {
            position: absolute;
            top: -10px;
            left: 0;
            right: 0;
            height: 20px;
            display: flex;
            justify-content: space-around;
        }

        .decoration-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: glow 1.5s ease-in-out infinite;
        }

        .decoration-light:nth-child(1) { background: var(--christmas-red); animation-delay: 0s; }
        .decoration-light:nth-child(2) { background: var(--christmas-green); animation-delay: 0.3s; }
        .decoration-light:nth-child(3) { background: var(--christmas-gold); animation-delay: 0.6s; }
        .decoration-light:nth-child(4) { background: var(--christmas-red); animation-delay: 0.9s; }
        .decoration-light:nth-child(5) { background: var(--christmas-green); animation-delay: 1.2s; }

        /* YouTubeåŸ‹ã‚è¾¼ã¿ */
        .youtube-container {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            border: 4px solid var(--wood-brown);
        }

        /* ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ› */
        .custom-input {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            width: 80px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .custom-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* é€²æ—ãƒãƒ¼ */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--christmas-gold), var(--light-glow));
            border-radius: 10px;
            transition: width 1s linear;
            box-shadow: 0 0 10px var(--light-glow);
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«è£…é£¾ */
        .title-decoration {
            color: var(--christmas-red);
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }

        /* ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º */
        .mode-badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .mode-focus {
            background: linear-gradient(135deg, var(--christmas-red), #E63946);
            color: white;
        }

        .mode-break {
            background: linear-gradient(135deg, var(--christmas-green), #2D8659);
            color: white;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media (max-width: 1024px) {
            .timer-display {
                font-size: 3.5rem;
            }
        }

        /* ã‚¹ãƒãƒ›æ¨ªç”»é¢å¯¾å¿œ */
        @media (max-width: 768px) and (orientation: landscape) {
            .timer-display {
                font-size: 2.5rem;
            }

            .title-decoration {
                font-size: 1.5rem;
            }

            .wood-panel {
                padding: 1rem;
            }

            .custom-input {
                width: 60px;
                font-size: 0.9rem;
            }

            .btn-warm, .btn-green {
                padding: 0.4rem 1rem;
                font-size: 0.85rem;
            }

            .preset-btn {
                padding: 0.3rem 0.7rem;
                font-size: 0.8rem;
            }

            .mode-badge {
                padding: 0.3rem 1rem;
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
            }

            h2 {
                font-size: 1rem !important;
                margin-bottom: 0.3rem !important;
            }

            /* æ¨ªç”»é¢ã§ã¯2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
            #main-screen > .grid {
                grid-template-columns: 1fr 1fr !important;
            }

            /* YouTubeåŸ‹ã‚è¾¼ã¿ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
            .youtube-container {
                height: 100% !important;
            }
        }

        /* ã‚¹ãƒãƒ›ç¸¦ç”»é¢å¯¾å¿œ */
        @media (max-width: 768px) and (orientation: portrait) {
            .timer-display {
                font-size: 2rem;
            }

            .title-decoration {
                font-size: 1.8rem;
            }

            .wood-panel {
                padding: 0.75rem;
            }

            .custom-input {
                width: 50px;
                font-size: 0.9rem;
                padding: 0.3rem 0.5rem;
            }

            .btn-warm, .btn-green {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            .preset-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }

            .mode-badge {
                padding: 0.3rem 1rem;
                font-size: 0.85rem;
            }

            h2 {
                font-size: 1.2rem !important;
                margin-bottom: 0.5rem !important;
            }
        }
    </style>
</head>
<body>
    <!-- é›ªã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="snow" id="snow-container"></div>

    <!-- ãƒˆãƒƒãƒ—ç”»é¢ï¼ˆLofi Girlé¸æŠï¼‰ -->
    <div id="selection-screen" class="min-h-screen flex items-center justify-center p-8">
        <div class="max-w-6xl w-full">
            <div class="text-center mb-12">
                <h1 class="title-decoration">â„ï¸ Winter Study Room â˜•</h1>
                <p class="text-2xl text-gray-700 font-medium">ä»Šæ—¥ã¯ã©ã‚Œè´ãï¼Ÿ</p>
                <p class="text-gray-600 mt-2">ãŠæ°—ã«å…¥ã‚Šã®Lofié…ä¿¡ã‚’é¸ã‚“ã§ã­</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- æŒ‡å®šå‹•ç”»1 -->
                <div class="stream-card" onclick="selectStream('C4qJeIjNd2U')">
                    <img src="https://img.youtube.com/vi/C4qJeIjNd2U/maxresdefault.jpg" alt="Lofi Stream 1" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-lg mb-2">ğŸµ Lofi Live 1</h3>
                        <p class="text-sm text-gray-600">24/7 chill beats</p>
                    </div>
                </div>

                <!-- æŒ‡å®šå‹•ç”»2 -->
                <div class="stream-card" onclick="selectStream('jfKfPfyJRdk')">
                    <img src="https://img.youtube.com/vi/jfKfPfyJRdk/maxresdefault.jpg" alt="Lofi Stream 2" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-lg mb-2">ğŸŒ™ Lofi Live 2</h3>
                        <p class="text-sm text-gray-600">Study & Relax</p>
                    </div>
                </div>

                <!-- æŒ‡å®šå‹•ç”»3 -->
                <div class="stream-card" onclick="selectStream('6gVgsOX3d_I')">
                    <img src="https://img.youtube.com/vi/6gVgsOX3d_I/maxresdefault.jpg" alt="Lofi Stream 3" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-lg mb-2">ğŸ¹ Lofi Live 3</h3>
                        <p class="text-sm text-gray-600">Chill & Focus</p>
                    </div>
                </div>
            </div>

            <!-- ã‚«ã‚¹ã‚¿ãƒ å‹•ç”»é¸æŠ -->
            <div class="text-center mt-8">
                <div class="inline-block bg-white rounded-2xl p-6 shadow-lg">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">ğŸ§ å¥½ããªå‹•ç”»ã‚’é¸ã¶</h3>
                    <p class="text-sm text-gray-600 mb-4">YouTubeã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ã­</p>
                    <div class="flex gap-3 items-center justify-center flex-wrap">
                        <input 
                            type="text" 
                            id="custom-video-url" 
                            placeholder="https://www.youtube.com/watch?v=..." 
                            class="px-4 py-2 border-2 border-gray-300 rounded-lg w-80 focus:outline-none focus:border-red-500 transition"
                        >
                        <button 
                            onclick="selectCustomVideo()" 
                            class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition transform hover:-translate-y-1"
                        >
                            å†ç”Ÿã™ã‚‹ â–¶
                        </button>
                    </div>
                </div>
            </div>

            <div class="text-center mt-6 text-gray-600">
                <p>ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã‚¿ã‚¤ãƒãƒ¼ã¨ä¸€ç·’ã«é›†ä¸­åŠ›ã‚¢ãƒƒãƒ—ï¼</p>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆã‚¿ã‚¤ãƒãƒ¼ + YouTubeï¼‰ -->
    <div id="main-screen" class="hidden h-screen overflow-hidden flex flex-col p-2 sm:p-4">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-6 h-full">
            <!-- å·¦å´ï¼šãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼ -->
            <div class="flex items-center justify-center p-1 sm:p-4 overflow-auto">
                <div class="wood-panel w-full max-w-lg relative">
                    <!-- ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒˆ -->
                    <div class="decoration-lights">
                        <div class="decoration-light"></div>
                        <div class="decoration-light"></div>
                        <div class="decoration-light"></div>
                        <div class="decoration-light"></div>
                        <div class="decoration-light"></div>
                    </div>

                    <div class="text-center">
                        <h2 class="text-2xl font-bold text-white mb-4">ğŸ„ ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼ â°</h2>
                        
                        <!-- ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º -->
                        <div class="mode-badge mode-focus" id="mode-badge">é›†ä¸­ã‚¿ã‚¤ãƒ </div>

                        <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º -->
                        <div class="timer-display" id="timer-display">25:00</div>

                        <!-- é€²æ—ãƒãƒ¼ -->
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 100%"></div>
                        </div>

                        <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
                        <div class="mt-6 mb-4">
                            <p class="text-white text-sm mb-2">ãƒ—ãƒªã‚»ãƒƒãƒˆæ™‚é–“</p>
                            <div class="flex flex-wrap gap-2 justify-center">
                                <button class="preset-btn active" onclick="setPreset(25)">25åˆ†</button>
                                <button class="preset-btn" onclick="setPreset(5)">5åˆ†</button>
                                <button class="preset-btn" onclick="setPreset(15)">15åˆ†</button>
                            </div>
                        </div>

                        <!-- ã‚«ã‚¹ã‚¿ãƒ æ™‚é–“å…¥åŠ› -->
                        <div class="mb-6">
                            <p class="text-white text-sm mb-2">ã‚«ã‚¹ã‚¿ãƒ æ™‚é–“</p>
                            <div class="flex gap-2 justify-center items-center">
                                <input type="number" class="custom-input" id="custom-minutes" placeholder="åˆ†" min="1" max="120">
                                <span class="text-white">åˆ†</span>
                                <button class="btn-green" onclick="setCustomTime()">è¨­å®š</button>
                            </div>
                        </div>

                        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
                        <div class="flex gap-4 justify-center">
                            <button class="btn-warm" id="start-btn" onclick="toggleTimer()">
                                <span id="btn-text">é–‹å§‹</span>
                            </button>
                            <button class="btn-green" onclick="resetTimer()">ãƒªã‚»ãƒƒãƒˆ</button>
                        </div>

                        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
                        <div class="mt-6">
                            <button class="text-white text-sm underline hover:text-gray-200" onclick="backToSelection()">
                                â† é…ä¿¡ã‚’å¤‰æ›´ã™ã‚‹
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šYouTubeåŸ‹ã‚è¾¼ã¿ -->
            <div class="flex items-center justify-center p-1 sm:p-4">
                <div class="youtube-container w-full aspect-video lg:h-[600px]">
                    <iframe 
                        id="youtube-player"
                        width="100%" 
                        height="100%" 
                        src="" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†éŸ³ï¼ˆæ§ãˆã‚ãªãƒ™ãƒ«éŸ³ï¼‰ -->
    <audio id="timer-sound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFgH55dHFta2l
        kb2djX1tXU09LREVBPT05NTIuKicjHxsXEw8LBwMAAP3564r9wOHCxcfJy83P0dPV19nb3d/h4+Xl5+no6err7O3u7+/w8fHy8vP09PT09
        fX19fb29vb39/f4+Pj4+Pn5+fn5+vr6+vr6+vv7+/v7+/v7/Pz8/Pz8/P39/f39/f39/f39/f39/f39/f39/f39/f39/fz8/Pz8/Pz7+/v7+
        /v7+vr6+vr6+vr5+fn5+fn4+Pj4+Pf39/f39vb29vb19fX19PT09PTz8/Ly8vHx8O/v7u7t7Ovq6ejo5+Xl4+Hf3dvZ19XT0c/NzcnHxcPBvru
        4trSxr62qp6ShnpuYlZKPjIl/" type="audio/wav">
    </audio>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let timer;
        let timeLeft = 25 * 60; // ç§’å˜ä½
        let totalTime = 25 * 60;
        let isRunning = false;
        let currentMode = 'focus'; // 'focus' or 'break'
        let wakeLock = null;

        // é›ªã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
        function createSnowflakes() {
            const container = document.getElementById('snow-container');
            const snowflakeCount = 50;

            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.width = (Math.random() * 3 + 2) + 'px';
                snowflake.style.height = snowflake.style.width;
                container.appendChild(snowflake);
            }
        }

        // é…ä¿¡é¸æŠ
        function selectStream(videoId) {
            document.getElementById('selection-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            document.getElementById('youtube-player').src = 
                `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0`;
            requestWakeLock();
        }

        // ã‚«ã‚¹ã‚¿ãƒ å‹•ç”»é¸æŠ
        function selectCustomVideo() {
            const url = document.getElementById('custom-video-url').value.trim();
            
            if (!url) {
                alert('YouTubeã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼');
                return;
            }

            // YouTube URLã‹ã‚‰Video IDã‚’æŠ½å‡º
            let videoId = null;
            
            // æ§˜ã€…ãªYouTube URLå½¢å¼ã«å¯¾å¿œ
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/,
                /youtube\.com\/embed\/([^&\s]+)/,
                /youtube\.com\/v\/([^&\s]+)/
            ];

            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    videoId = match[1];
                    break;
                }
            }

            if (!videoId) {
                alert('æœ‰åŠ¹ãªYouTube URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nä¾‹: https://www.youtube.com/watch?v=xxxxx');
                return;
            }

            // å‹•ç”»ã‚’å†ç”Ÿ
            selectStream(videoId);
            document.getElementById('custom-video-url').value = '';
        }

        // é¸æŠç”»é¢ã«æˆ»ã‚‹
        function backToSelection() {
            if (isRunning) {
                if (!confirm('ã‚¿ã‚¤ãƒãƒ¼ãŒå®Ÿè¡Œä¸­ã§ã™ã€‚æœ¬å½“ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }
                resetTimer();
            }
            document.getElementById('main-screen').classList.add('hidden');
            document.getElementById('selection-screen').classList.remove('hidden');
            document.getElementById('youtube-player').src = '';
            releaseWakeLock();
        }

        // ãƒ—ãƒªã‚»ãƒƒãƒˆæ™‚é–“è¨­å®š
        function setPreset(minutes) {
            if (isRunning) {
                if (!confirm('ã‚¿ã‚¤ãƒãƒ¼ãŒå®Ÿè¡Œä¸­ã§ã™ã€‚ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }
                resetTimer();
            }

            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã®åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            timeLeft = minutes * 60;
            totalTime = minutes * 60;
            updateDisplay();
            updateProgress();
        }

        // ã‚«ã‚¹ã‚¿ãƒ æ™‚é–“è¨­å®š
        function setCustomTime() {
            const minutes = parseInt(document.getElementById('custom-minutes').value);
            if (!minutes || minutes < 1 || minutes > 120) {
                alert('1ã€œ120åˆ†ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (isRunning) {
                if (!confirm('ã‚¿ã‚¤ãƒãƒ¼ãŒå®Ÿè¡Œä¸­ã§ã™ã€‚ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }
                resetTimer();
            }

            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            timeLeft = minutes * 60;
            totalTime = minutes * 60;
            updateDisplay();
            updateProgress();
            document.getElementById('custom-minutes').value = '';
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹/åœæ­¢
        function toggleTimer() {
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        function startTimer() {
            isRunning = true;
            document.getElementById('btn-text').textContent = 'ä¸€æ™‚åœæ­¢';
            
            timer = setInterval(() => {
                timeLeft--;
                updateDisplay();
                updateProgress();

                if (timeLeft <= 0) {
                    timerComplete();
                }
            }, 1000);
        }

        // ã‚¿ã‚¤ãƒãƒ¼ä¸€æ™‚åœæ­¢
        function pauseTimer() {
            isRunning = false;
            clearInterval(timer);
            document.getElementById('btn-text').textContent = 'å†é–‹';
        }

        // ã‚¿ã‚¤ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆ
        function resetTimer() {
            isRunning = false;
            clearInterval(timer);
            timeLeft = totalTime;
            updateDisplay();
            updateProgress();
            document.getElementById('btn-text').textContent = 'é–‹å§‹';
        }

        // ã‚¿ã‚¤ãƒãƒ¼å®Œäº†
        function timerComplete() {
            clearInterval(timer);
            isRunning = false;
            
            // æ§ãˆã‚ãªé€šçŸ¥éŸ³ã‚’å†ç”Ÿ
            const sound = document.getElementById('timer-sound');
            sound.play();

            // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
            if (currentMode === 'focus') {
                currentMode = 'break';
                timeLeft = 5 * 60;
                totalTime = 5 * 60;
                document.getElementById('mode-badge').textContent = 'ä¼‘æ†©ã‚¿ã‚¤ãƒ ';
                document.getElementById('mode-badge').className = 'mode-badge mode-break';
                alert('ğŸ‰ ãŠç–²ã‚Œæ§˜ï¼ä¼‘æ†©ã‚¿ã‚¤ãƒ ã§ã™ â˜•');
            } else {
                currentMode = 'focus';
                timeLeft = 25 * 60;
                totalTime = 25 * 60;
                document.getElementById('mode-badge').textContent = 'é›†ä¸­ã‚¿ã‚¤ãƒ ';
                document.getElementById('mode-badge').className = 'mode-badge mode-focus';
                alert('ğŸ’ª ä¼‘æ†©çµ‚äº†ï¼é›†ä¸­ã‚¿ã‚¤ãƒ ã§ã™ ğŸ“š');
            }

            updateDisplay();
            updateProgress();
            document.getElementById('btn-text').textContent = 'é–‹å§‹';
        }

        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // é€²æ—ãƒãƒ¼æ›´æ–°
        function updateProgress() {
            const progress = (timeLeft / totalTime) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // Wake Lock APIï¼ˆç”»é¢ã‚ªãƒ³ç¶­æŒï¼‰
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock activated');
                }
            } catch (err) {
                console.log('Wake Lock error:', err);
            }
        }

        function releaseWakeLock() {
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', () => {
            createSnowflakes();
            updateDisplay();
        });

        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®Wake Lockè§£æ”¾
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible' && document.getElementById('main-screen').classList.contains('hidden') === false) {
                requestWakeLock();
            }
        });
    </script>
</body>
</html>
